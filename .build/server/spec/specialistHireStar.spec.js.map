{
  "version": 3,
  "sources": ["../../../server/spec/specialistHireStar.spec.ts"],
  "sourcesContent": ["const mongoose = require('mongoose');\nimport SpecialistHireService from '../services/specialistHire';\n\ndescribe('specialistHire - Star', () => {\n\n    // -------------\n    // Mock Objects\n\n    function setup() {\n        let obj = {\n            service: {} as any,\n            gameRepo: {\n                bulkWrite: () => {}\n            },\n            specialistService: {} as any,\n            technologyService: {\n                getStarEffectiveTechnologyLevels: () => {}\n            },\n            achievementService: {\n                incrementSpecialistsHired: () => {}\n            },\n            waypointService: {\n                cullWaypointsByHyperspaceRangeDB: () => {}\n            },\n            playerService: {} as any,\n            playerCreditsService: {} as any,\n            starService: {} as any,\n            gameTypeService: {\n                isTutorialGame: () => { return false; }\n            },\n            specialistBanService: {\n                isStarSpecialistBanned: () => { return false; }\n            },\n            game: { \n                settings: {\n                    specialGalaxy: {\n                        specialistCost: 'standard',\n                        specialistsCurrency: 'credits',\n                        specialistBans: {\n                            star: [] as any,\n                            carrier: [] as any\n                        }\n                    }\n                },\n                galaxy: {\n                    carriers: [] as any[],\n                    stars: [] as any[]\n                }\n            },\n            playerId: new mongoose.Types.ObjectId(),\n            player: {\n                _id: null,\n                credits: 0,\n                creditsSpecialists: 0\n            },\n            starId: new mongoose.Types.ObjectId(),\n            specialistId: 1\n        };\n\n        obj.player._id = obj.playerId;\n\n        // @ts-ignore\n        obj.service = new SpecialistHireService(obj.gameRepo, obj.specialistService, obj.achievementService, obj.waypointService, obj.playerCreditsService, obj.starService, obj.gameTypeService, obj.specialistBanService, obj.technologyService);\n\n        return obj;\n    }\n\n    function starWithSpecialist(testObj, specId) {\n        return {\n            _id: testObj.starId,\n            ownedByPlayerId: testObj.playerId,\n            specialistId: specId || null\n        };\n    }\n\n    function specialistBasic(testObj) {\n        return {\n            id: testObj.specialistId\n        }\n    }\n\n    // -------------\n\n    it('should throw an error if specialists are disabled', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        testObj.game.settings.specialGalaxy.specialistCost = 'none';\n\n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('disabled the hiring of specialists');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should throw an error if the specialist is banned', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        testObj.specialistBanService.isStarSpecialistBanned = () => true;\n\n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('banned');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should throw an error if the star does not exist', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('you do not own');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should throw an error if the star is dead', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        testObj.game.galaxy.stars.push(starWithSpecialist(testObj, null));\n\n        testObj.starService.isDeadStar = () => {\n            return true;\n        };\n\n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('dead star');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should throw an error if the specialist does not exist', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        testObj.game.galaxy.stars.push(starWithSpecialist(testObj, null));\n\n        testObj.starService.isDeadStar = () => {\n            return false;\n        };\n\n        testObj.specialistService.getByIdStar = () => {\n            return null;\n        };\n        \n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('does not exist');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should throw an error if the specialist is already on the star', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        testObj.game.galaxy.stars.push(starWithSpecialist(testObj, testObj.specialistId));\n\n        testObj.starService.isDeadStar = () => {\n            return false;\n        };\n\n        testObj.specialistService.getByIdStar = () => {\n            return specialistBasic(testObj);\n        };\n        \n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('already has the specialist assigned');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should throw an error if the player cannot afford the specialist by credits', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        testObj.game.galaxy.stars.push(starWithSpecialist(testObj, null));\n\n        testObj.starService.isDeadStar = () => {\n            return false;\n        };\n\n        testObj.specialistService.getByIdStar = () => {\n            return specialistBasic(testObj);\n        };\n\n        testObj.specialistService.getSpecialistActualCost = () => {\n            return {\n                credits: 1000\n            }\n        };\n\n        testObj.game.settings.specialGalaxy.specialistsCurrency = 'credits';\n        testObj.player.credits = 1;\n        \n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('cannot afford');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should throw an error if the player cannot afford the specialist by specialist credits', async () => {\n        let testObj = setup();\n        let hasError = false;\n\n        testObj.game.galaxy.stars.push(starWithSpecialist(testObj, null));\n\n        testObj.starService.isDeadStar = () => {\n            return false;\n        };\n\n        testObj.specialistService.getByIdStar = () => {\n            return specialistBasic(testObj);\n        };\n\n        testObj.specialistService.getSpecialistActualCost = () => {\n            return {\n                creditsSpecialists: 1000\n            }\n        };\n\n        testObj.game.settings.specialGalaxy.specialistsCurrency = 'creditsSpecialists';\n        testObj.player.creditsSpecialists = 1;\n        \n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n            expect(err.message).toContain('cannot afford');\n        }\n        \n        expect(hasError).toBeTruthy();\n    });\n\n    it('should assign the specialist to the star', async () => {\n        let testObj = setup();\n        let hasError = false;\n        let star = starWithSpecialist(testObj, null);\n\n        testObj.game.galaxy.stars.push(star);\n\n        testObj.specialistService.getByIdStar = (id) => {\n            return specialistBasic(testObj);\n        };\n\n        testObj.starService.isDeadStar = () => {\n            return false;\n        };\n\n        testObj.specialistService.getSpecialistActualCost = () => {\n            return {\n                credits: 100\n            }\n        };\n\n        testObj.playerCreditsService.addCredits = (game, player, amount: number) => {\n            expect(amount).toBe(-100);\n        };\n\n        testObj.game.settings.specialGalaxy.specialistsCurrency = 'credits';\n        testObj.player.credits = 100;\n\n        try {\n            await testObj.service.hireStarSpecialist(testObj.game, testObj.player, testObj.starId, testObj.specialistId);\n        } catch (err: any) {\n            hasError = true;\n        }\n        \n        expect(hasError).toBeFalsy();\n        expect(star.specialistId).toBe(testObj.specialistId);\n        expect(testObj.player.credits).toBe(0);\n    });\n})"],
  "mappings": "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",
  "names": ["SpecialistHireService"]
}
