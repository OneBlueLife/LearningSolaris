{
  "version": 3,
  "sources": ["../../../server/db/migrate.ts"],
  "sourcesContent": ["import config from '../config';\nimport mongooseLoader from '.';\nimport fs from 'fs';\nimport path from 'path';\n\nlet mongo;\n\nasync function startup() {\n    mongo = await mongooseLoader(config, {\n        syncIndexes: true,\n        poolSize: 1\n    });\n    \n    console.log('Running migrations...');\n\n    const dirPath: string = path.join(__dirname, 'migrations');\n\n    let files: string[] = fs.readdirSync(dirPath)\n        .filter(a => !a.endsWith('js.map'))\n        .sort((a, b) => a.localeCompare(b));\n\n    for (let file of files) {\n        console.log(file);\n    \n        const filePath = path.join(dirPath, file);\n        const script = require(filePath);\n\n        try {\n            await script.migrate(mongo.connection.db);\n        } catch (e) {\n            console.error(e);\n\n            return Promise.reject(e);\n        }\n    }\n    \n    return Promise.resolve();\n}\n\nprocess.on('SIGINT', async () => {\n    await shutdown();\n});\n\nasync function shutdown() {\n    console.log('Shutting down...');\n\n    await mongo.disconnect();\n\n    console.log('Shutdown complete.');\n    \n    process.exit();\n}\n\nstartup().then(async () => {\n    console.log('Database migrated.');\n\n    await shutdown();\n}).catch(async err => {\n    await shutdown();\n});\n\nexport {};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA,oBAAmB;AACnB,eAA2B;AAC3B,gBAAe;AACf,kBAAiB;AAEjB,IAAI;AAEJ,eAAe,UAAU;AACrB,UAAQ,UAAM,SAAAA,SAAe,cAAAC,SAAQ;AAAA,IACjC,aAAa;AAAA,IACb,UAAU;AAAA,EACd,CAAC;AAED,UAAQ,IAAI,uBAAuB;AAEnC,QAAM,UAAkB,YAAAC,QAAK,KAAK,WAAW,YAAY;AAEzD,MAAI,QAAkB,UAAAC,QAAG,YAAY,OAAO,EACvC,OAAO,OAAK,CAAC,EAAE,SAAS,QAAQ,CAAC,EACjC,KAAK,CAAC,GAAG,MAAM,EAAE,cAAc,CAAC,CAAC;AAEtC,WAAS,QAAQ,OAAO;AACpB,YAAQ,IAAI,IAAI;AAEhB,UAAM,WAAW,YAAAD,QAAK,KAAK,SAAS,IAAI;AACxC,UAAM,SAAS,QAAQ,QAAQ;AAE/B,QAAI;AACA,YAAM,OAAO,QAAQ,MAAM,WAAW,EAAE;AAAA,IAC5C,SAAS,GAAP;AACE,cAAQ,MAAM,CAAC;AAEf,aAAO,QAAQ,OAAO,CAAC;AAAA,IAC3B;AAAA,EACJ;AAEA,SAAO,QAAQ,QAAQ;AAC3B;AAEA,QAAQ,GAAG,UAAU,YAAY;AAC7B,QAAM,SAAS;AACnB,CAAC;AAED,eAAe,WAAW;AACtB,UAAQ,IAAI,kBAAkB;AAE9B,QAAM,MAAM,WAAW;AAEvB,UAAQ,IAAI,oBAAoB;AAEhC,UAAQ,KAAK;AACjB;AAEA,QAAQ,EAAE,KAAK,YAAY;AACvB,UAAQ,IAAI,oBAAoB;AAEhC,QAAM,SAAS;AACnB,CAAC,EAAE,MAAM,OAAM,QAAO;AAClB,QAAM,SAAS;AACnB,CAAC;",
  "names": ["mongooseLoader", "config", "path", "fs"]
}
