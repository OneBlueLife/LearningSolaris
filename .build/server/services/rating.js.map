{
  "version": 3,
  "sources": ["../../../server/services/rating.ts"],
  "sourcesContent": ["import Repository from \"./repository\";\nimport { Game } from \"./types/Game\";\nimport { User } from \"./types/User\";\nimport UserService from \"./user\";\n\nconst EloRating = require('elo-rating');\n\nexport default class RatingService {\n    userRepo: Repository<User>;\n    gameRepo: Repository<Game>;\n    userService: UserService;\n\n    constructor(\n        userRepo: Repository<User>,\n        gameRepo: Repository<Game>,\n        userService: UserService\n    ) {\n        this.userRepo = userRepo;\n        this.gameRepo = gameRepo;\n        this.userService = userService;\n    }\n\n    recalculateEloRating(userA: User, userB: User, userAIsWinner: boolean) {\n        // Note that some players may no longer have accounts, in which case consider it a win for the\n        // player against the same rank as their own.\n        let userARating = userA == null ? userB.achievements.eloRating : userA.achievements.eloRating;\n        let userBRating = userB == null ? userA.achievements.eloRating : userB.achievements.eloRating;\n\n        let eloResult = EloRating.calculate(\n            userARating == null ? 1200 : userARating, \n            userBRating == null ? 1200 : userBRating, \n            userAIsWinner);\n\n        if (userA) {\n            userA.achievements.eloRating = eloResult.playerRating;\n        }\n\n        if (userB) {\n            userB.achievements.eloRating = eloResult.opponentRating;\n        }\n    }\n\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA,MAAM,YAAY,QAAQ,YAAY;AAEtC,MAAO,cAA4B;AAAA,EAK/B,YACI,UACA,UACA,aACF;AACE,SAAK,WAAW;AAChB,SAAK,WAAW;AAChB,SAAK,cAAc;AAAA,EACvB;AAAA,EAEA,qBAAqB,OAAa,OAAa,eAAwB;AAGnE,QAAI,cAAc,SAAS,OAAO,MAAM,aAAa,YAAY,MAAM,aAAa;AACpF,QAAI,cAAc,SAAS,OAAO,MAAM,aAAa,YAAY,MAAM,aAAa;AAEpF,QAAI,YAAY,UAAU;AAAA,MACtB,eAAe,OAAO,OAAO;AAAA,MAC7B,eAAe,OAAO,OAAO;AAAA,MAC7B;AAAA,IAAa;AAEjB,QAAI,OAAO;AACP,YAAM,aAAa,YAAY,UAAU;AAAA,IAC7C;AAEA,QAAI,OAAO;AACP,YAAM,aAAa,YAAY,UAAU;AAAA,IAC7C;AAAA,EACJ;AAEJ;AAAC;",
  "names": []
}
